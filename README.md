# 開発ガイドラインと詳細実装計画

## 基本動作原則
1. **指示の受信と理解**
   - ユーザーからの指示を注意深く読み取り
   - 不明点がある場合は、具体的な質問を行う
   - 技術的な制約や要件を明確に把握
   - 指示された以外の処理を行わない

2. **深い分析とプランニング**
   ## タスク分析
   - 目的：[タスクの最終目標]
   - 技術要件：[使用する技術スタックと制約]
   - 実装手順：[具体的なステップ]
   - リスク：[潜在的な問題点]
   - 品質基準：[満たすべき基準]

3. **詳細な実装計画の策定**
   - 機能要件を細分化した具体的なタスクへの分解
   - 各タスクの推定所要時間と依存関係の明確化
   - 技術的依存関係を考慮した実施順序の最適化
   - 各タスクの具体的な完了基準の設定
   - タスクの優先順位付けと実装フェーズの定義
   - リスク対策と代替アプローチの準備
   - 完成した詳細実装計画をREADME.mdに追加

4. **ステップバイステップの実装とマイルストーン管理**
   - 定義された各タスクを順序通りに一つずつ実装
   - 各タスク完了後の明確なチェックポイント設定
   - タスク完了ごとの進捗報告とREADME.md更新
   - マイルストーン達成時の総合チェックと品質レビュー実施
   - 次のフェーズに進む前の依存関係の充足確認
   - 変更が必要な場合は実装計画の更新と記録

5. **継続的なフィードバックと品質検証**
   - 各タスク完了時の自己レビューと品質チェック
   - 実装の進捗状況を定期的に報告（各タスク完了ごと）
   - 重要な判断ポイントでの確認と意思決定の記録
   - 問題発生時の解決策提案と影響分析の実施
   - 各実装タスク完了時のプルリクエスト作成と詳細な説明
   - README.mdの進捗状況セクションをタスクごとに更新

## 技術スタックと制約
### コア技術
- TypeScript: ^5.0.0
- Node.js: ^20.0.0
### フロントエンド
- Next.js: ^15.1.3
- React: ^19.0.0
- Tailwind CSS: ^3.4.17
- shadcn/ui: ^2.1.8
### バックエンド
- Firebase: ^10.5.0
- Firestore: ^10.5.0
- Firebase Authentication: ^10.5.0
- Firebase Cloud Functions: ^10.5.0 (オプション)
### テスト
- Jest: ^29.7.0
- React Testing Library: ^15.0.0
- Cypress: ^13.6.0 (E2Eテスト)

## 品質管理プロトコル
### 1. コード品質
- TypeScriptの厳格な型チェック
- ESLintルールの完全準拠
- コードの一貫性維持
### 2. パフォーマンス
- 不要な再レンダリングの防止
- 効率的なデータフェッチング
- バンドルサイズの最適化
- Firestoreクエリの最適化
### 3. セキュリティ
- 入力値の厳格なバリデーション
- 適切なエラーハンドリング
- 機密情報の安全な管理
- Firebaseセキュリティルールの厳格な設定
### 4. UI/UX
- レスポンシブデザインの確保
- アクセシビリティ基準の遵守
- 一貫したデザインシステムの維持
### 5. テスト品質
- 単体テストの十分なカバレッジ (最低80%)
- 統合テストによる主要機能検証
- E2Eテストによるユーザーフロー検証

## プロジェクト構造規約
new/
├── .env                     # 環境変数（本番用、gitignore対象）
├── .env.local               # ローカル環境変数（開発用、gitignore対象）
├── .env.example             # 環境変数のテンプレート（gitignore対象外）
├── README.md                # プロジェクト概要と実装計画・進捗状況
├── src/
│   ├── app/                 # ページコンポーネント
│   │   └── api/            # APIルート (必要な場合)
│   ├── components/          # 再利用可能なコンポーネント
│   │   ├── ui/             # 基本UI要素
│   │   └── layout/         # レイアウトコンポーネント
│   ├── lib/                # ユーティリティ関数とヘルパー
│   │   ├── firebase/       # Firebase初期化と設定
│   │   │   ├── config.ts  # Firebase設定（環境変数を参照）
│   │   │   ├── auth/      # 認証関連の処理
│   │   │   └── firestore/ # Firestoreアクセス関数
│   │   └── utils/          # 汎用ユーティリティ
│   ├── types/              # TypeScript型定義
│   ├── styles/             # グローバルスタイル
│   ├── usecases/           # ユースケースの実装
│   └── tests/              # テストファイル
│       ├── unit/           # 単体テスト
│       ├── integration/    # 統合テスト
│       └── e2e/            # E2Eテスト
├── firebase/               # Firebaseの設定と関数
│   ├── firestore.rules     # Firestoreセキュリティルール
│   └── functions/          # Cloud Functions (オプション)
└── public/                 # 静的アセット

## 重要な制約
1. **コード配置**
   - 共通処理は `src/lib/utils/` に配置
   - UIコンポーネントは `src/components/ui/` に配置
   - Firebase関連の初期化と設定は `src/lib/firebase/` に配置
   - Firestoreデータアクセス関数は `src/lib/firebase/firestore/` に配置
   - Firebase Authentication関連の処理は `src/lib/firebase/auth/` に配置
   - ユースケースは `src/usecases/` に配置

2. **環境変数と認証情報**
   - Firebaseの認証情報は `.env` または `.env.local` に保存
   - 環境変数は `NEXT_PUBLIC_FIREBASE_` プレフィックスを使用
   - 秘密鍵やAPIキーはクライアントサイドで直接公開しない
   - `.env.example` にはダミー値を使用し、必要な環境変数の構造を示す
   - プロダクション環境の認証情報は安全な場所で管理し、CIパイプラインで自動挿入する

3. **バージョン管理とコミット規約**
   - 各タスク単位で独立したコミットを作成する
   - コミットメッセージは「type(scope): subject」の形式で記述
     - type: feat, fix, docs, style, refactor, test, chore など
     - scope: 影響範囲（auth, firestore, ui-component など）
     - subject: 変更内容を簡潔に説明（命令形、現在形）
   - タスクID（番号）をコミットメッセージに含める
   - 一時的なコードやデバッグログを含めない
   - コミットの前にlintとテストが通過することを確認
   - ビルドが壊れる状態でのコミットを避ける

4. **プルリクエストとコードレビュー**
   - 各実装フェーズは独立したブランチで開発
   - フェーズ完了時に詳細な説明を含むプルリクエストを作成
   - プルリクエストには以下を含める：
     - 実装したタスク一覧とタスクID
     - 各タスクの完了基準の達成状況
     - テスト結果と品質指標
     - 発生した問題と解決策
     - 次のフェーズへの影響
   - マージ前にコードレビューと自動テストの通過を確認

5. **ドキュメント更新**
   - README.mdは常に最新の状態を維持
   - 実装計画の更新はREADME.mdに反映
   - 進捗状況はタスクごとに更新（各タスク完了時）
   - 重要な技術的決定や設計変更もREADME.mdに記録
   - 各タスクの完了日、担当者、PRリンクを記録

## 改良された実装プロセス
### 1. 初期分析フェーズ
#### 1.1 要件分析 (推定: 1-2日)
- **タスク1.1.1**: 機能要件の詳細リスト作成
- **タスク1.1.2**: 非機能要件の詳細リスト作成
- **タスク1.1.3**: 技術的制約の確認と文書化
- **タスク1.1.4**: 既存コードとの整合性確認（該当する場合）
- **成果物**: 要件分析文書

#### 1.2 ユースケース定義 (推定: 1-2日)
- **タスク1.2.1**: 主要なユーザーフローの特定と図式化
- **タスク1.2.2**: アクター（ユーザー役割）の定義と権限マッピング
- **タスク1.2.3**: 各ユースケースのシナリオ記述（正常フローと代替フロー）
- **タスク1.2.4**: 前提条件と事後条件の明確化
- **タスク1.2.5**: ユースケース間の関連と依存関係の定義
- **成果物**: ユースケース仕様書

#### 1.3 リスク評価 (推定: 1日)
- **タスク1.3.1**: 潜在的な技術的課題の特定と影響度評価
- **タスク1.3.2**: パフォーマンスリスクの特定と対策案策定
- **タスク1.3.3**: セキュリティリスクの特定と対策案策定
- **タスク1.3.4**: Firestoreの設計とスケーリングの考慮点抽出
- **タスク1.3.5**: リスク軽減戦略の策定
- **成果物**: リスク評価文書

#### マイルストーン1: 初期分析の完了
- 要件分析文書のレビューと承認
- ユースケース仕様書のレビューと承認
- リスク評価文書のレビューと承認
- 初期分析フェーズ完了報告

### 2. 設計フェーズ
#### 2.1 データモデル設計 (推定: 2-3日)
- **タスク2.1.1**: エンティティ関係図（ER図）の作成
- **タスク2.1.2**: Firestoreコレクション構造設計
- **タスク2.1.3**: データアクセスパターンの分析と最適化
- **タスク2.1.4**: TypeScript型定義の設計
- **タスク2.1.5**: データバリデーションルールの定義
- **成果物**: データモデル設計書とTypeScript型定義

#### 2.2 アーキテクチャ設計 (推定: 2-3日)
- **タスク2.2.1**: 全体アーキテクチャ図の作成
- **タスク2.2.2**: コンポーネント間の依存関係図作成
- **タスク2.2.3**: 認証フローの設計
- **タスク2.2.4**: ステート管理戦略の設計
- **タスク2.2.5**: APIとデータフェッチング戦略の設計
- **タスク2.2.6**: エラーハンドリング戦略の設計
- **成果物**: アーキテクチャ設計書

#### 2.3 UI/UX設計 (推定: 2-3日)
- **タスク2.3.1**: 画面遷移図の作成
- **タスク2.3.2**: 各画面のワイヤーフレーム作成
- **タスク2.3.3**: コンポーネント設計とコンポーネント階層の定義
- **タスク2.3.4**: レスポンシブデザイン戦略の策定
- **タスク2.3.5**: アクセシビリティ要件の整理
- **成果物**: UI/UX設計書とワイヤーフレーム

#### 2.4 テスト計画 (推定: 1-2日)
- **タスク2.4.1**: テスト戦略の策定
- **タスク2.4.2**: 単体テスト計画の作成
- **タスク2.4.3**: 統合テスト計画の作成
- **タスク2.4.4**: E2Eテスト計画の作成
- **タスク2.4.5**: テストデータ準備計画の作成
- **成果物**: テスト計画書

#### マイルストーン2: 設計フェーズの完了
- データモデル設計書のレビューと承認
- アーキテクチャ設計書のレビューと承認
- UI/UX設計書のレビューと承認
- テスト計画書のレビューと承認
- 設計フェーズ完了報告

### 3. 環境構築フェーズ
#### 3.1 開発環境構築 (推定: 1-2日)
- **タスク3.1.1**: プロジェクトリポジトリのセットアップ
- **タスク3.1.2**: Next.jsプロジェクトの初期化
- **タスク3.1.3**: TypeScriptの設定
- **タスク3.1.4**: ESLintとPrettierの設定
- **タスク3.1.5**: 基本的なディレクトリ構造の作成
- **成果物**: 初期化されたプロジェクト

#### 3.2 CI/CD構築 (推定: 1日)
- **タスク3.2.1**: CIパイプラインの設定
- **タスク3.2.2**: テスト自動化の設定
- **タスク3.2.3**: デプロイフローの設定
- **タスク3.2.4**: 環境変数管理の設定
- **成果物**: CI/CD設定

#### 3.3 Firebase環境構築 (推定: 1日)
- **タスク3.3.1**: Firebaseプロジェクトの作成
- **タスク3.3.2**: Firestoreの初期設定
- **タスク3.3.3**: Firebase Authenticationの設定
- **タスク3.3.4**: Firebase Cloud Functionsの設定（必要な場合）
- **タスク3.3.5**: 環境変数の設定
- **成果物**: 設定済みFirebase環境

#### マイルストーン3: 環境構築フェーズの完了
- 開発環境の動作確認
- CI/CDパイプラインの動作確認
- Firebase環境の動作確認
- 環境構築フェーズ完了報告

### 4. 基盤実装フェーズ
#### 4.1 Firebase統合 (推定: 2-3日)
- **タスク4.1.1**: Firebase初期化モジュールの実装
- **タスク4.1.2**: Firestoreデータアクセス基盤の実装
- **タスク4.1.3**: 認証基盤の実装
- **タスク4.1.4**: セキュリティルールの実装
- **タスク4.1.5**: Firestoreインデックス設定
- **成果物**: Firebase統合基盤コード

#### 4.2 コンポーネント基盤 (推定: 2-3日)
- **タスク4.2.1**: UIコンポーネントライブラリのセットアップ
- **タスク4.2.2**: 共通レイアウトコンポーネントの実装
- **タスク4.2.3**: フォームコンポーネントの実装
- **タスク4.2.4**: ナビゲーションコンポーネントの実装
- **タスク4.2.5**: モーダル/ダイアログコンポーネントの実装
- **成果物**: 基本UIコンポーネント

#### 4.3 ユーティリティ実装 (推定: 1-2日)
- **タスク4.3.1**: 日付操作ユーティリティの実装
- **タスク4.3.2**: バリデーションユーティリティの実装
- **タスク4.3.3**: フォーマットユーティリティの実装
- **タスク4.3.4**: エラーハンドリングユーティリティの実装
- **タスク4.3.5**: ロギングユーティリティの実装
- **成果物**: ユーティリティ関数群

#### 4.4 テスト基盤 (推定: 1-2日)
- **タスク4.4.1**: Jestセットアップとテスト環境構築
- **タスク4.4.2**: React Testing Libraryセットアップ
- **タスク4.4.3**: Cypressセットアップ（E2Eテスト用）
- **タスク4.4.4**: テストヘルパーとモックの実装
- **タスク4.4.5**: テストデータ生成スクリプトの実装
- **成果物**: テスト基盤コード

#### マイルストーン4: 基盤実装フェーズの完了
- Firebase統合基盤のテストと動作確認
- コンポーネント基盤のテストと動作確認
- ユーティリティのテストと動作確認
- テスト基盤の動作確認
- 基盤実装フェーズ完了報告

### 5. 機能実装フェーズ
#### 5.1 認証機能 (推定: 2-3日)
- **タスク5.1.1**: サインアップフローの実装
- **タスク5.1.2**: ログインフローの実装
- **タスク5.1.3**: パスワードリセットフローの実装
- **タスク5.1.4**: ユーザープロフィール管理の実装
- **タスク5.1.5**: 認証状態の永続化と管理
- **タスク5.1.6**: 認証機能の単体テスト
- **タスク5.1.7**: 認証機能の統合テスト
- **成果物**: 認証機能一式

#### 5.2 データ管理機能 (推定: 3-4日)
- **タスク5.2.1**: データ作成機能の実装
- **タスク5.2.2**: データ読み取り機能の実装
- **タスク5.2.3**: データ更新機能の実装
- **タスク5.2.4**: データ削除機能の実装
- **タスク5.2.5**: データ検索・フィルタリング機能の実装
- **タスク5.2.6**: データページング機能の実装
- **タスク5.2.7**: データ管理機能の単体テスト
- **タスク5.2.8**: データ管理機能の統合テスト
- **成果物**: データ管理機能一式

#### 5.3 UI実装 (推定: 3-4日)
- **タスク5.3.1**: ホーム画面の実装
- **タスク5.3.2**: ダッシュボード画面の実装
- **タスク5.3.3**: フォーム画面の実装
- **タスク5.3.4**: 詳細表示画面の実装
- **タスク5.3.5**: 設定画面の実装
- **タスク5.3.6**: レスポンシブデザインの適用
- **タスク5.3.7**: アクセシビリティ対応
- **タスク5.3.8**: UI実装の単体テスト
- **タスク5.3.9**: UI実装の統合テスト
- **成果物**: UI実装一式

#### 5.4 APIとの連携 (推定: 2-3日)
- **タスク5.4.1**: APIエンドポイントの実装
- **タスク5.4.2**: データフェッチング処理の実装
- **タスク5.4.3**: エラーハンドリングの実装
- **タスク5.4.4**: キャッシング戦略の実装
- **タスク5.4.5**: オフライン対応（必要な場合）
- **タスク5.4.6**: API連携機能の単体テスト
- **タスク5.4.7**: API連携機能の統合テスト
- **成果物**: API連携機能一式

#### マイルストーン5: 機能実装フェーズの完了
- 認証機能のテストと動作確認
- データ管理機能のテストと動作確認
- UI実装のテストと動作確認
- API連携機能のテストと動作確認
- 機能実装フェーズ完了報告