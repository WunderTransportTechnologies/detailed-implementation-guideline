# フェーズ3: 環境構築フェーズ

環境構築フェーズでは、開発、テスト、デプロイのための環境を整備します。この段階で適切な環境を構築することで、開発の効率性が高まり、品質保証も容易になります。

## 3.1 開発環境構築 (推定: 1-2日)

### タスク3.1.1: プロジェクトリポジトリのセットアップ
- **内容**: バージョン管理のためのGitリポジトリを設定
- **ステップ**:
  1. GitHubでの新規リポジトリ作成
  2. リポジトリの基本設定（README.md、.gitignore、ライセンスなど）
  3. ブランチ保護ルールの設定
  4. コラボレーターの追加とアクセス権管理
- **成果物**: セットアップされたGitリポジトリ
- **完了基準**: リポジトリが作成され、基本設定が完了し、チームメンバーがアクセス可能な状態になっていること

### タスク3.1.2: Next.jsプロジェクトの初期化
- **内容**: Next.jsプロジェクトの基本構造を作成
- **ステップ**:
  1. Next.jsプロジェクトの作成（create-next-app）
  2. 必要な依存関係のインストール
  3. プロジェクト構造の構築規約に合わせた調整
  4. 基本的な動作確認
- **成果物**: 初期化されたNext.jsプロジェクト
- **完了基準**: プロジェクトが正常に起動し、開発サーバーが動作すること

### タスク3.1.3: TypeScriptの設定
- **内容**: TypeScriptの設定を最適化
- **ステップ**:
  1. tsconfig.jsonの設定調整
  2. 厳格なタイプチェックの有効化
  3. パスエイリアスの設定
  4. 型定義ファイルの基本構造作成
- **成果物**: 最適化されたTypeScript設定
- **完了基準**: TypeScriptの厳格なルールが設定され、型チェックが正常に機能すること

### タスク3.1.4: ESLintとPrettierの設定
- **内容**: コード品質とスタイル統一のためのツール設定
- **ステップ**:
  1. ESLintの設定ファイル作成と調整
  2. Prettierの設定ファイル作成と調整
  3. ESLintとPrettierの連携設定
  4. ハスキー（Git hooks）の設定
- **成果物**: ESLintとPrettierの設定ファイル
- **完了基準**: コードスタイルが自動的に統一され、品質チェックが機能すること

### タスク3.1.5: 基本的なディレクトリ構造の作成
- **内容**: プロジェクト構造規約に基づいたディレクトリ構造の作成
- **ステップ**:
  1. 規約に従ったディレクトリ構造の作成
  2. 各ディレクトリの役割を明記したREADME.mdの追加
  3. サンプルファイルやプレースホルダーの追加
  4. ディレクトリ構造の検証
- **成果物**: 基本的なディレクトリ構造
- **完了基準**: プロジェクト構造規約に準拠したディレクトリ構造が作成され、各ディレクトリの役割が明確になっていること

## 3.2 CI/CD構築 (推定: 1日)

### タスク3.2.1: CIパイプラインの設定
- **内容**: 継続的インテグレーションのためのパイプライン設定
- **ステップ**:
  1. GitHub Actionsのワークフロー定義ファイル作成
  2. ビルド、リント、テストの自動化設定
  3. プルリクエスト時の自動チェック設定
  4. CI結果の通知設定
- **成果物**: CI設定ファイルとワークフロー
- **完了基準**: コードの変更が自動的にビルド、リント、テストされるCIパイプラインが動作すること

### タスク3.2.2: テスト自動化の設定
- **内容**: 自動テスト実行環境の構築
- **ステップ**:
  1. Jestの設定ファイル作成と調整
  2. React Testing Libraryの設定
  3. Cypressの設定（E2Eテスト用）
  4. テストカバレッジレポート生成の設定
- **成果物**: テスト自動化設定
- **完了基準**: テストが自動的に実行され、結果とカバレッジレポートが生成されること

### タスク3.2.3: デプロイフローの設定
- **内容**: 継続的デリバリー/デプロイメントのフロー設定
- **ステップ**:
  1. ステージング環境と本番環境の定義
  2. 自動デプロイのためのワークフロー作成
  3. ロールバック手順の定義
  4. デプロイ通知の設定
- **成果物**: CD設定ファイルとワークフロー
- **完了基準**: コードがマージされた後、自動的に適切な環境にデプロイされるフローが設定されていること

### タスク3.2.4: 環境変数管理の設定
- **内容**: 環境変数の安全かつ効率的な管理方法の設定
- **ステップ**:
  1. 環境変数の種類と用途の定義
  2. 環境変数のテンプレート（.env.example）作成
  3. GitHub Secretsでの秘密情報の管理設定
  4. 環境ごとの変数切り替え設定
- **成果物**: 環境変数管理システム
- **完了基準**: 環境変数が安全に管理され、各環境で適切に利用できること

## 3.3 Firebase環境構築 (推定: 1日)

### タスク3.3.1: Firebaseプロジェクトの作成
- **内容**: Firebase Consoleでプロジェクトを作成
- **ステップ**:
  1. Firebaseコンソールでの新規プロジェクト作成
  2. プロジェクト設定の構成
  3. 開発、ステージング、本番環境のプロジェクト作成（必要に応じて）
  4. アプリの登録（Webアプリ）
- **成果物**: 設定済みFirebaseプロジェクト
- **完了基準**: プロジェクトが作成され、アプリが登録されていること

### タスク3.3.2: Firestoreの初期設定
- **内容**: Firestoreデータベースの設定
- **ステップ**:
  1. Firestoreデータベースの作成
  2. 基本セキュリティルールの設定
  3. インデックスの初期設定
  4. 必要に応じてダミーデータの準備
- **成果物**: 設定済みFirestoreデータベース
- **完了基準**: Firestoreデータベースが作成され、基本的なセキュリティルールが設定されていること

### タスク3.3.3: Firebase Authenticationの設定
- **内容**: 認証方法の設定
- **ステップ**:
  1. 必要な認証プロバイダの有効化（メール/パスワード、Google、他のソーシャルログインなど）
  2. 認証設定の調整
  3. テスト用のダミーユーザーの作成
  4. 認証エミュレータの設定（開発用）
- **成果物**: 設定済みFirebase Authentication
- **完了基準**: 認証機能が有効化され、テストアカウントでログインできること

### タスク3.3.4: Firebase Cloud Functionsの設定（必要な場合）
- **内容**: サーバーレス関数の環境設定
- **ステップ**:
  1. Cloud Functions環境の初期化
  2. 基本的な関数のテンプレート作成
  3. デプロイフローの設定
  4. テスト環境の構築
- **成果物**: 設定済みCloud Functions環境
- **完了基準**: Cloud Functions環境が構築され、基本的な関数がデプロイできること

### タスク3.3.5: 環境変数の設定
- **内容**: Firebase接続のための環境変数設定
- **ステップ**:
  1. Firebase構成情報の取得
  2. 環境変数ファイルへの追加
  3. 開発、ステージング、本番環境の設定分離
  4. セキュリティ確認（秘密鍵の管理など）
- **成果物**: Firebase関連の環境変数設定
- **完了基準**: アプリケーションがFirebaseサービスに正常に接続できること

## マイルストーン3: 環境構築フェーズの完了

環境構築フェーズの完了時には、以下の項目をチェックし、マイルストーンの達成を確認します。

### 確認事項
- **開発環境の動作確認**
  - プロジェクトリポジトリのアクセス確認
  - ローカル開発サーバーの起動確認
  - TypeScriptコンパイルの確認
  - ESLintとPrettierの動作確認
  - ディレクトリ構造の検証

- **CI/CDパイプラインの動作確認**
  - CIパイプラインのテスト実行
  - コードチェックの自動化確認
  - テスト自動化の動作確認
  - デプロイフローのシミュレーション
  - 環境変数管理の検証

- **Firebase環境の動作確認**
  - Firebaseプロジェクトへのアクセス確認
  - Firestoreデータベースの動作確認
  - 認証機能のテスト
  - Cloud Functionsの動作確認（該当する場合）
  - Firebase接続の確認

### 次のフェーズへの移行基準
1. すべての開発環境が正常に機能している
2. CI/CDパイプラインが適切に設定され、動作している
3. Firebase環境が構築され、アプリケーションが接続できる
4. チームメンバー全員が環境にアクセスでき、開発作業を開始できる
5. 基盤実装フェーズの詳細計画が準備されている

### 成果物チェックリスト
- [ ] セットアップされたGitリポジトリ
- [ ] 初期化されたNext.jsプロジェクト
- [ ] TypeScript設定ファイル（tsconfig.json）
- [ ] ESLintとPrettier設定ファイル
- [ ] 基本的なディレクトリ構造
- [ ] CI設定ファイルとワークフロー
- [ ] テスト自動化設定
- [ ] CD設定ファイルとワークフロー
- [ ] 環境変数管理システム
- [ ] 設定済みFirebaseプロジェクト
- [ ] 設定済みFirestoreデータベース
- [ ] 設定済みFirebase Authentication
- [ ] 設定済みCloud Functions環境（必要な場合）
- [ ] Firebase関連の環境変数設定
- [ ] 環境構築フェーズ完了報告書